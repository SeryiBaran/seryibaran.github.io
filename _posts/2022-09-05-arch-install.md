---
title: "Установка Arch Linux"
author: Иванчай
date: 2022-09-05 12:27:27 +0300
categories: [it]
tags: [it, linux]
uploads: "/uploads/2022-09-05-arch-install"
---

> Статья **не была протестирована**. Когда я протестирую команды в статье - я уберу это предупреждение.
{: .prompt-danger }

```
БАЗОВАЯ УСТАНОВКА

  ПЕРВИЧНАЯ НАСТРОЙКА WI-FI ДЛЯ УСТАНОВКИ

    Проверить соединение:
      ping -c 5 archlinux.org

    Определить название WiFi интерфейса:
      iwconfig

    Подключение к Wi-Fi с помощью утилиты wifi-menu:
      wifi-menu имя_интерфейса





  РАЗМЕТКА ДИСКА

    ЗАПУСК РАЗМЕТКИ
      Выведем список дисков и разделов:
        fdisk -l

      Отсюда мы можем видеть наш диск /dev/sda.
      Я создам всего два раздела — корневой раздел и раздел подкачки (swap раздел).
      Если у вас достаточный объем оперативной памяти (4-8Gb и более), то можно swap не создавать.
      Запускаем утилиту cfdisk и указываем, что мы хотим работать над диском /dev/sda:
        cfdisk /dev/sda



    ВЫБОР ТАБЛИЦЫ РАЗДЕЛОВ
      DOS - MBR
      GPT - UEFI



    РАЗМЕТКА ДЛЯ UEFI

      СОЗДАНИЕ РАЗДЕЛА ЗАГРУЗЧИКА
        Выберите свободное место с помощью стрелок вверх/вниз, а потом с помощью стрелок вправо/влево выберите пункт New и нажмите Enter.

        Далее введите размер диска.
        Минимальный размер раздела для загрузчика 300 МБ, для этого укажите 300M.
        Если вы хотите сделать раздел с запасом для установки нескольких дистрибутивов, можете выделить под него до 1 ГБ памяти.

        После выбора размера нажмите Enter. Новый раздел появится в списке разделов.



      РАЗДЕЛ ДЛЯ ОБРАЗА ЗАГРУЗЧИКА
        Для установки Grub в GPT необходимо создать отдельный раздел для начального образа загрузчика, который раньше писался в MBR.
        Так же, как и раньше переместитесь на свободное место и выберите New.
        Укажите размер 1М, этого вполне достаточно.

        Оставаясь на новом разделе, с помощью клавиш со стрелками вправо/влево выберите Type и нажмите Enter.
        Далее из выпадающего списка выберите Bios boot.
        Это необходимо для того чтобы загрузчик знал куда ему устанавливаться.



      КОРНЕВОЙ РАЗДЕЛ
        Дальше необходимо создать главный системный раздел.
        Опять переместитесь на одно положение вниз до надписи Free space, и нажмите New.
        Выберите размер раздела в пределах от 15 до 50 ГБ. Для ввода размера в гигабайтах используется буква G.



      РАЗДЕЛ ПОДКАЧКИ (ПО ЖЕЛАНИЮ)
        Дальше можно создать раздел подкачки.
        Он должен иметь размер такой же, как и размер вашей оперативной памяти.
        Например: 4G. Порядок действий аналогичный.
        После его создания, выделите его, с помощью стрелок вправо/влево выберите пункт Type и нажмите Enter, появится список возможных типов разделов, задаем тип linux swap.



      ДОМАШНИЙ РАЗДЕЛ
        Дальше желательно создать домашний раздел, на котором будут хранится все ваши файлы, размер раздела - всё доступное пространство, чем больше - тем лучше.



      СОХРАНЕНИЕ ИЗМЕНЕНИЙ
        Нажмите кнопку Write и наберите yes.
        Затем нажмите Quit, чтобы выйти из программы.



      РАЗДЕЛЫ В ЭТОЙ ПАМЯТКЕ ДЛЯ UEFI
        /dev/sda - диск
        /dev/sda1 - раздел загрузчика
        /dev/sda2 - раздел для начального образа загрузчика, который раньше писался в MBR
        /dev/sda3 - корневой раздел (системный)
        /dev/sda4 - раздел подкачки
        /dev/sda5 - домашний раздел



      ФОРМАТИРОВАНИЕ ФАЙЛОВЫХ СИСТЕМ
        Сначала нужно отформатировать раздел загрузчика в Ext2:
          mkfs -t ext2 -L boot /dev/sda1

        Второй раздел /dev/sda2, который будет использоваться для загрузчика форматировать не нужно.

        Форматирование корневого раздела в Ext4:
          mkfs -t ext4 -L root /dev/sda3

        Форматирование раздела подкачки:
          mkswap /dev/sda4

        Форматирование домашнего раздела:
          mkfs -t ext4 -L home /dev/sda5



      МОНТИРОВАНИЕ ФАЙЛОВЫХ СИСТЕМ
        Монтировать будем в папку /mnt.

        Монтирование корневого раздела:
          mount /dev/sda3 /mnt

        Создание папки для монтирования разделов home и boot:
          mkdir /mnt/{boot,home}

        Монтирование раздела загрузчика:
          mount /dev/sda1 /mnt/boot

        Монтирование домашнего раздела:
          mount /dev/sda5 /mnt/home

        Включение swap на разделе:
          swapon /dev/sda5



    РАЗМЕТКА ДЛЯ MBR

      СОЗДАНИЕ РАЗДЕЛА ЗАГРУЗЧИКА
        Выберите свободное место с помощью стрелок вверх/вниз, а потом с помощью стрелок вправо/влево выберите пункт New и нажмите Enter.

        Далее введите размер диска.
        Минимальный размер раздела для загрузчика 300 МБ, для этого укажите 300M.
        Если вы хотите сделать раздел с запасом для установки нескольких дистрибутивов, можете выделить под него до 1 ГБ памяти.

        После выбора размера нажмите Enter. Новый раздел появится в списке разделов.



      КОРНЕВОЙ РАЗДЕЛ
        Дальше необходимо создать главный системный раздел.
        Переместитесь на одно положение вниз до надписи Free space, и нажмите New.
        Выберите размер раздела в пределах от 15 до 50 ГБ. Для ввода размера в гигабайтах используется буква G.



      ДОМАШНИЙ РАЗДЕЛ
        Дальше желательно создать домашний раздел, на котором будут хранится все ваши файлы, размер раздела - всё доступное пространство (кроме пространства для swap, если он нужен), чем больше - тем лучше.



      РАЗДЕЛ ПОДКАЧКИ (ПО ЖЕЛАНИЮ)
        Дальше можно создать раздел подкачки.
        Он должен иметь размер такой же, как и размер вашей оперативной памяти.
        Например: 4G. Порядок действий аналогичный.
        После его создания, выделите его, с помощью стрелок вправо/влево выберите пункт Type и нажмите Enter, появится список возможных типов разделов, задаем тип linux swap.



      СОХРАНЕНИЕ ИЗМЕНЕНИЙ
        Нажмите кнопку Write и наберите yes.
        Затем нажмите Quit, чтобы выйти из программы.



      РАЗДЕЛЫ В ЭТОЙ ПАМЯТКЕ ДЛЯ MBR
        /dev/sda - диск
        /dev/sda1 - раздел загрузчика
        /dev/sda2 - корневой раздел (системный)
        /dev/sda3 - домашний раздел
        /dev/sda4 - раздел подкачки



      ФОРМАТИРОВАНИЕ ФАЙЛОВЫХ СИСТЕМ
        Сначала нужно отформатировать раздел загрузчика в Ext2:
          mkfs -t ext2 -L boot /dev/sda1

        Форматирование корневого раздела в Ext4:
          mkfs -t ext4 -L root /dev/sda2

        Форматирование домашнего раздела:
          mkfs -t ext4 -L home /dev/sda3

        Форматирование раздела подкачки:
          mkswap /dev/sda4



      МОНТИРОВАНИЕ ФАЙЛОВЫХ СИСТЕМ
        Монтировать будем в папку /mnt.

        Монтирование корневого раздела:
          mount /dev/sda2 /mnt

        Создание папки для монтирования разделов home и boot:
          mkdir /mnt/{boot,home}

        Монтирование раздела загрузчика:
          mount /dev/sda1 /mnt/boot

        Монтирование домашнего раздела:
          mount /dev/sda3 /mnt/home

        Включение swap на разделе:
          swapon /dev/sda4





  ВЫБОР ЗЕРКАЛА
    По умолчанию все пакеты будут скачиваться с зеркал, настроенных в файле /etc/pacman.d/mirrorlist.
    Вы можете отредактировать файл вручную и поднять географически близкие до вас зеркала вверх:
      vim /etc/pacman.d/mirrorlist
    Для сохранения изменений в Vim наберите :wq и нажмите Enter.
    Можно пропустить этот шаг.





  УСТАНОВКА СИСТЕМЫ
    pacstrap /mnt base base-devel linux linux-firmware





  СОЗДАНИЕ ФАЙЛА FSTAB
    Создание файла описания подключённых файловых систем на основе точек монтирования /mnt:
      genfstab -U /mnt >> /mnt/etc/fstab





  НАЧАЛЬНЫЙ ВХОД В СИСТЕМУ 
    Наша новая система установлена и для её дальнейшей настройки нам нужно войти в неё, но без перезагрузки, потому что загрузчик и сеть в ней ещё не готовы.
    Выполните команду для входа в систему:
      arch-chroot /mnt





  ВРЕМЯ
    ЧАСОВОЙ ПОЯС
      Указываем часовой пояс с помощью символической ссылки на него в файле /etc/localtime при помощи команды:
        ln -s /usr/share/zoneinfo/Europe/Moscow /etc/localtime



    СПОСОБ ХРАНЕНИЯ ТАЙМЕРА
      Далее необходимо настроить способ синхронизации системного времени между перезагрузками.
      Есть два способа, UTC и localtime.
      Если вы используете Windows, выберите localtime, иначе можно брать utc:
        Для UTC:
          hwclock --systohc --utc
        Для localtime:
          hwclock --systohc --localtime





  ВРЕМЯ - ВТОРОЙ СПОСОБ
    Включите синхронизацию времени через интернет:
      timedatectl set-ntp true

    Теперь необходимо установить часовой пояс. Для просмотра доступных
    часовых поясов воспользуйтесь командой:
      timedatectl list-timezones

    Можно, например, вывести доступные часовые зоны для Европы:
      timedatectl list-timezones | grep Europe

    Установите ваш часовой пояс:
      timedatectl set-timezone Europe/Moscow

    Для проверки времени используется команда:
      timedatectl status
    Убедитесь, что в поле «Local time» указано верное время.





  REFLECTOR
    Эта утилита отсортирует зеркала по пингу и запишет первые 30 из них в /etc/pacman.d/mirrorlist.
    Использование reflector:
      Обновление кэша репозиториев:
        pacman -Sy
      Установка утилиты reflector:
        pacman -S reflector
      Сортировка утилитой списка зеркал
        reflector --verbose -l 30 --sort rate --save /etc/pacman.d/mirrorlist





  УСТАНОВКА ТЕКСТОВОГО РЕДАКТОРА
    Установка vim:
      pacman -S vim

    Установка nano:
      pacman -S nano





  ЛОКАЛИЗАЦИЯ
    Язык, который использует система, определяется локалью.
    Помимо языка интерфейса локаль определяет и форматы чисел, времени, даты и некоторые другие региональные особенности.
    Для поддержки русского и/или других языков необходимо раскомментировать соответствующие строки (локали) в файле /etc/locale.gen.
    Откройте файл для редактирования:
      nano /etc/locale.gen
    Я раскомментировал строки:
      en_US.UTF-8 UTF-8 
      ru_RU.UTF-8 UTF-8
    Сохраните изменения и закройте файл.

    Теперь генерируем локали.
    Для этого выполняем команду:
      locale-gen
    Установим переменную LANG в файле /etc/locale.conf.
    Создадим файл /etc/locale.conf (используем редактор nano):
      nano /etc/locale.conf
    Введите текст:
      LANG=ru_RU.UTF-8
    Сохраните и закройте файл.

    Также добавим русскую раскладку клавиатуры для консоли и шрифт с поддержкой кириллицы:
      nano /etc/vconsole.conf
    Введите строки:
      KEYMAP=ru 
      FONT=cyr-sun16
    Сохраните и закройте файл.





  ИМЯ КОМПЬЮТЕРА
    Имя компьютера задаётся в файле /etc/hostname (вместо "arch-pc" можно написать что угодно, но только англ. буквами и "-", без пробелов):
      echo "arch-pc" > /etc/hostname

    Теперь добавим имя нашего компьютера в файл /etc/hosts:
      127.0.0.1          localhost.localdomain          localhost
      ::1                localhost.localdomain          localhost
      127.0.0.1          arch-pc.localdomain            arch-pc





  СОЗДАНИЕ ОБРАЗА РАННЕЙ ЗАГРУЗКИ
    В некоторых случаях ядру необходима начальная файловая система initcpio.
    Arch Linux не настроен, чтобы работать без этого образа, поэтому его нужно создать:
      mkinitcpio -plinux





  ПАРОЛЬ СУПЕРПОЛЬЗОВАТЕЛЯ
    Установка пароля суперпользователя:
      passwd
      Далее программа спросит, какой пароль вы хотите установить. Пишите тот пароль, который хотите, но без спец. символов, без пробелов и только английскими буквами. Цифры использовать можно.





  СОЗДАНИЕ ПОЛЬЗОВАТЕЛЯ
    Вам понадобится обычный пользователь для работы в системе.
    В этом примере показано как создать пользователя alex (вместо alex пишите что угодно маленькими англ. буквами без пробелов):
      useradd -m -g users -G wheel -s /bin/bash alex
    Здесь -g указывает основную группу, -G - дополнительные, группа wheel даёт возможность использовать команду sudo, больше пока не нужно.
    Опция -s задаёт командную оболочку, а последний параметр - имя пользователя.

    Теперь необходимо создать пароль для этого пользователя (вместо alex пишите что угодно маленькими англ. буквами без пробелов):
      passwd alex
    Далее программа спросит, какой пароль вы хотите установить. Пишите тот пароль, который хотите, но без спец. символов, без пробелов и только английскими буквами. Цифры использовать можно.





  ЗАГРУЗЧИК
    Далее нам нужно установить загрузчик.
    Устанавливаем grub:
      pacman -S grub

    Далее установим загрузчик на диск(не раздел!). Вместо sda пишите название диска, в котором находится корневой раздел:
      grub-install /dev/sda

    Создаём конфигурационный файл:
      grub-mkconfig -o /boot/grub/grub.cfg





  НАСТРОЙКА ИНТЕРНЕТА
    Для понятной и легкой настройки, я рекомендую использовать Network Manager.
    Установим его:
      pacman -S networkmanager
    Добавим его в автозагрузку:
      systemctl enable NetworkManager
    Тем самым мы упростим настройку сети в готовой системе после ее загрузки.
    Вся настройка сети будет происходить в псевдографическом интерфейсе NetworkManager.
    Попасть в который можно введя команду:
      nmtui

    Графический интерфейс для NM:
      pacman -S nm-connection-editor



    АППЛЕТЫ (устанавливаются после установки граф. окружения)
      KDE:
        sudo pacman -S plasma-nm
      GTK:
        sudo pacman -S network-manager-applet





  УСТАНОВКА SUDO
    Для установки sudo выполните команду (если sudo уже есть, то не надо):
      pacman -S sudo

    Теперь разрешим пользователям группы wheel использование sudo.
    Когда мы создавали пользователя, то мы добавили его в группу wheel, поэтому он сможет пользоваться sudo.
    Выполняем команду:
      visudo
    Откроется редактор Vi с файлом настроек sudo.
    Найдите строку «# %wheel ALL=(ALL) ALL».
    Строка закомментирована (перед ней стоит символ решетки #).
    Нам нужно раскомментировать ее (то есть удалить символ решетки).
    Также можно удалить пробел, который стоял после решетки.
    Теперь нужно сохранить изменения и закрыть редактор.
    Для этого нажмите двоеточие « : », в нижней части экрана появится строка для ввода символов.
    Введите wq и нажмите  Enter.
    Если вдруг вы не хотите сохранять изменения, а хотите просто закрыть редактор, то вместо wq введите q!.





  ПЕРЕЗАГРУЗКА
    Первоначальная настройка системы завершена.
    Для выхода из окружения chroot выполните:
      exit

    Размонтируйте файловые системы:
      umount -R /mnt

    Перезагрузите компьютер:
      reboot










НАСТРОЙКА

  ОБНОВЛЕНИЕ СИСТЕМЫ
    sudo pacman -Syu





  УСТАНОВКА ГРАФИЧЕСКИХ ДРАЙВЕРОВ
    Если с драйверами основных устройств проблем нет, то драйвера на видеокарту нужно устанавливать отдельно, и это не зависит от того хотите вы использовать открытые драйвера или закрытые.
    Выберите подходящий для вашей карты драйвер из следующего списка:
      xf86-video-amdgpu - новый, свободный драйвер для видеокарт AMD;
      xf86-video-ati - старый свободный драйвер для AMD;
      xf86-video-intel - драйвер для встроенной графики Intel;
      xf86-video-nouveau - свободный драйвер для карт NVIDIA;
      xf86-video-vesa - свободный драйвер, поддерживающий все карты, но с очень ограниченной функциональностью;
      nvidia - проприетарный драйвер для NVIDIA.
    Я бы не советовал с самого начала ставить проприетарный драйвер.
    Поэтому вам остается выбрать один из доступных свободных драйверов.
    Если вы используете виртуальную машину - ваш драйвер - vesa.
    Теперь устанавливаем:
      sudo pacman -S xf86-video-vesa





  УСТАНОВКА XORG
    Установим Xorg:
      sudo pacman -S xorg
    Соглашаемся на установку всех пакетов.





  УСТАНОВКА ГРАФИЧЕСКОГО ОКРУЖЕНИЯ
    GNOME:
      sudo pacman -S gnome gnome-extra
    Cinnamon:
      sudo pacman -S cinnamon nemo-fileroller
    XFCE:
      sudo pacman -S xfce4 xfce4-goodies
    KDE:
      sudo pacman -S plasma
    MATE:
      sudo pacman -S mate mate-extra





  УСТАНОВКА ОКНА ВХОДА
    LXDM
      Установка:
        sudo pacman -S lxdm
      Запуск при каждой перезагрузке системы:
        sudo systemctl enable lxdm.service

    SDDM
      SDDM устанавливается по умолчанию вместе с KDE.
      Если вы хотите использовать его вне KDE, его нужно  установить:
        sudo pacman -S sddm sddm-kcm
      Запуск при каждой перезагрузке системы:
        sudo systemctl enable sddm

    LightDM
      Установка:
        sudo pacman -S lightdm lightdm-gtk-greeter
      Запуск при каждой перезагрузке системы:
        sudo systemctl enable lightdm.service

    Перезагрузка компьютера:
      reboot





  НАСТРОЙКА ЗВУКА
    Устанавливаем нужные утилиты:
      sudo pacman -S alsa-utils alsa-plugins pulseaudio pulseaudio-alsa

    Дальше запустите утилиту alsamixer и включите нужные звуковые устройства.
    Запуск утилиты:
      alsamixer
    Значок MM означает, что устройство отключено.
    Чтобы включить и настроить уровень громкости нажимайте стрелку вверх.
    Когда завершите, нажмите Esc для выхода из утилиты.

    Чтобы проверить работает ли звук вы можете выполнить:
      speaker-test -c 2

    Если используется XFCE, нужно поставить апплеты:
      sudo pacman -S xfce4-pulseaudio-plugin pavucontrol

    Если используется KDE, нужно поставить апплеты:
      sudo pacman -S kmix plasma-pa





  УСТАНОВКА КОДЕКОВ
    sudo pacman -S gst-plugins-base gst-plugins-good gst-libav gst-plugins-bad gst-plugins-ugly     





  ШРИФТ В ТЕРМИНАЛЕ
    Если шрифт ужасен, выполните команду и перезагрузите терминал:
      sudo pacman -S ttf-dejavu










УСТАНОВКА ПАКЕТОВ
  sudo pacman -S firefox libreoffice vlc










P.S> Я на виртуалке ставлю так:
  /dev/sda - диск
  /dev/sda1 - раздел загрузчика
  /dev/sda2 - корневой раздел (системный)
  /dev/sda3 - раздел подкачки










ПОИСК ПАКЕТОВ
  sudo pacman -Ss название
```
