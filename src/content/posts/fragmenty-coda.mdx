---
title: "Фрагменты кода"
description: "Разные куски кода, команды и программы."
pubDatetime: 2023-04-19T20:00:00
tags: ["программирование"]
---

import Alert from "@components/Alert";

## Содержание

Разные куски кода, команды и программы.

Эта статья будет обновляться!

## Счетчик на разных стейт менеджерах

### Nanostores - микроскопический стейт менеджере размером ~0.3-1 килобайт

<Alert>[Репозиторий Nanostores](https://github.com/nanostores/nanostores/)</Alert>
<Alert>1 килобайт это **в ~70 раз меньше** Jquery</Alert>

```ts
import { atom } from 'nanostores';

const count = atom(0);

function increment() {
  count.set(count.get() + 1);
}

count.subscribe(() => {
  console.log(`count is ${count.get()}`);
}); // count is 0 (полезно для первичного рендера)

increment(); // count is 1
increment(); // count is 2
```

### Reatom - стейт менеджер здорового человека ценою в ~6 килобайт

<Alert>[Оффициальный сайт Reatom](https://www.reatom.dev/)</Alert>
<Alert>6 килобайт это **в ~11 раз меньше** Jquery</Alert>

```ts
import { createCtx, action, atom } from '@reatom/framework';

const ctx = createCtx();

const counterAtom = atom(0);

const increment = action((ctx) => {
  counterAtom(ctx, ctx.get(counterAtom) + 1);
}, 'increment');

ctx.subscribe(counterAtom, (count) => {
  console.log(`count is ${count}`);
}); // count is 0 (полезно для первичного рендера)

increment(ctx); // count is 1
increment(ctx); // count is 2
```

### Effector - звезда Telegram чатов по React.js

<Alert>[Оффициальный сайт Effector](https://effector.dev/)</Alert>

```ts
import { createEvent, createStore } from 'effector';

const $count = createStore(0);

const increment = createEvent('increment');

$count.on(increment, (count) => count + 1);

$count.watch((count) => {
  console.log(`count is ${count}`);
}); // count is 0 (полезно для первичного рендера)

increment(); // count is 1
increment(); // count is 2
```

## Генерация случаяного около-пастельного цвета

[Песочница](https://codepen.io/SeryiBaran/pen/ZEqbqQR)

```html
<button id="rdm">Random pastel color!</button>
```

```js
function randomHSLPastelColor() {
  return `hsl(${Math.round(360 * Math.random())}, 70%,  80%)`;
}

rdm.onclick = () => (document.body.style.background = randomHSLPastelColor());
rdm.click();
```

## Фикс юникода в CMD в Windows

```cpp
/*
* Фикс юникода в CMD
* Просто импортируйте этот файл.
* https://t.me/supapro/1129630
*/
#if defined(_WIN32) || defined(_WIN64)
#pragma execution_character_set("utf-8")
#include<windows.h>
const auto _dummy_ = []() {
    SetConsoleCP(65001);
    SetConsoleOutputCP(65001);
    return 0;
}();
#endif
```

## Разрешение доступа к 80 порту программе (в данном случае Node.js) в Linux

```bash
sudo setcap cap_net_bind_service=+ep `readlink -f \`which node\``
```

## Настройка переключения языка в tty (например по Shift+Alt) в Linux

```bash
sudo dpkg-reconfigure keyboard-configuration
```

## Вставка HTML файлов по URL в страницу в рантайме с помощью кастомных тегов

```html
<sb-include data-src="/path/to/file.html" />
```

```js
class SbInclude extends HTMLElement {
  connectedCallback() {
    fetch(this.dataset.src)
      .then(res => res.text())
      .then(data => {
        this.outerHTML = data;
      });
  }
}

customElements.define("sb-include", SbInclude);
```

## Генерация массива чисел при помощи магии

```js
Number.prototype[Symbol.iterator] = function* () {
  for (let i = 0; i < this; i++) yield i + 1;
};

console.log([...5]); // [1, 2, 3, 4, 5]
```

## Генерация массива `[1, 2, 3, ..., 999, 1000]`

```js
console.log(Array.from(Array(1000)).map((_, index) => index + 1)); // [1, 2, 3, ..., 999, 1000]
```

## Реализация фильтра в JS

```js
Array.prototype.likeFilter = function (f) {
  let re = [];
  this.forEach(e => {
    if (f(e)) {
      re.push(e);
    }
  });
  return re;
};

const arr = [1, 2, 3, 4, 5, 6];

console.log(arr.likeFilter(value => value % 2 == 0)); // [2, 4, 6]
```

## Счетчик положительных чисел в массиве

```js
const countOfPositive = arr => arr.reduce((store, current) => (current > 0 ? store + 1 : store), 0);
```

## Конвертация высоты дисплеев 16x9 в ширину

```js
const listOf16x9Height = [1080, 720, 360];

const listOf16x9Width = listOf16x9Height.map(height => (height / 9) * 16);

console.log(listOf16x9Width);
```

## `forEach` у объекта

```js
Object.prototype.forEach = Array.prototype.forEach;

Object.defineProperty(Object.prototype, "length", {
  get: () => Object.keys(this).length,
});

let a = {
  0: 123,
  1: "test",
};

a.forEach(e => console.log(e));

console.log(a.forEach); // forEach() { [native code] }
```

## Ошибка в VSCode на Kubuntu (при входе в Github)

```
Не удалось записать сведения о входе в цепочку ключей. Ошибка: \"GDBus.Error:org.freedesktop.DBus.Error.ServiceUnknown: The name org.freedesktop.secrets was not provided by any .service files\".
```

Решение:

```bash
sudo apt install gnome-keyring
```

## Контролируемый цикл `setTimeout`'ов на JS

```js
const createLoop = (onStep, timeout) => {
  let running = false;

  const iteration = () => {
    onStep();
    if (running) setTimeout(iteration, timeout);
  };

  const start = () => {
    running = true;
    iteration();
  };

  const stop = () => {
    running = false;
  };

  return { start, stop };
};

const mainLoop = createLoop(() => {
  console.log("test");
}, 100);
```

## Удаление уведомлений ВКонтакте

<Alert type="warning">Удаляются только те, что показаны в меню уведомлений</Alert>

```js
document.querySelectorAll(".top_notify_cont .ui_actions_menu").forEach(elem => {
  elem.childNodes[0].click();
});
```

## ~~Простая~~ тупая реализация переключения темной темы

```js
function switchTheme() {
  wrapper.classList.toggle("dark-theme");
  wrapper.classList.toggle("light-theme");

  if (wrapper.classList.contains("dark-theme")) {
    localStorage.setItem("theme", "dark");
  } else {
    localStorage.setItem("theme", "light");
  }
}

if (localStorage.getItem("theme") == "dark") {
  themeSwitcher.setAttribute("checked", "");
  switchTheme();
} else {
  themeSwitcher.removeAttribute("checked");
}

themeSwitcher.addEventListener("click", switchTheme);
```

## Фикс тени над соседними элементами

[Песочница](https://jsbin.com/muyazupuko/edit?html,css,output)
![Скриншот](/uploads/fragmenty-coda/shadows-without-bugs.webp)

```html
<div class="wrap">
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
  <div class="element"></div>
</div>
```

```css
.wrap {
  filter: drop-shadow(0 0 10px gray);
}

.element {
  display: inline-block;
  width: 111px;
  height: 111px;
  background-color: #fff;
  border-radius: 2em;
}
```

## Анимации из Jquery

```js
export const SlideAnimations = {
  slideUp: function (element, duration = 500) {
    return new Promise(function (resolve, reject) {
      element.style.height = element.offsetHeight + "px";
      element.style.transitionProperty = `height, margin, padding`;
      element.style.transitionDuration = duration + "ms";
      element.offsetHeight;
      element.style.overflow = "hidden";
      element.style.height = 0;
      element.style.paddingTop = 0;
      element.style.paddingBottom = 0;
      element.style.marginTop = 0;
      element.style.marginBottom = 0;
      window.setTimeout(function () {
        element.style.display = "none";
        element.style.removeProperty("height");
        element.style.removeProperty("padding-top");
        element.style.removeProperty("padding-bottom");
        element.style.removeProperty("margin-top");
        element.style.removeProperty("margin-bottom");
        element.style.removeProperty("overflow");
        element.style.removeProperty("transition-duration");
        element.style.removeProperty("transition-property");
        resolve(false);
      }, duration);
    });
  },
  slideDown: function (element, duration = 500) {
    return new Promise(function (resolve, reject) {
      element.style.removeProperty("display");
      let display = window.getComputedStyle(element).display;
      if (display === "none") display = "block";
      element.style.display = display;
      let height = element.offsetHeight;
      element.style.overflow = "hidden";
      element.style.height = 0;
      element.style.paddingTop = 0;
      element.style.paddingBottom = 0;
      element.style.marginTop = 0;
      element.style.marginBottom = 0;
      element.offsetHeight;
      element.style.transitionProperty = `height, margin, padding`;
      element.style.transitionDuration = duration + "ms";
      element.style.height = height + "px";
      element.style.removeProperty("padding-top");
      element.style.removeProperty("padding-bottom");
      element.style.removeProperty("margin-top");
      element.style.removeProperty("margin-bottom");
      window.setTimeout(function () {
        element.style.removeProperty("height");
        element.style.removeProperty("overflow");
        element.style.removeProperty("transition-duration");
        element.style.removeProperty("transition-property");
      }, duration);
    });
  },
  slideToggle: function (element, duration = 500) {
    if (window.getComputedStyle(element).display === "none") {
      return this.slideDown(element, duration);
    } else {
      return this.slideUp(element, duration);
    }
  },
};
```

## Простой рендер таблицы на JS

```js
let data = [
  [1, 2, 3, 4, 5],
  ["a", "b", "c", "d", "i"],
];
console.log(
  data.map(row => {
    return `<tr>${row
      .map(col => {
        return `<td>${col}</td>`;
      })
      .join("")}</tr>`;
  })
);
```

## Запуск web-ext с firefox developer

```bash
web-ext run --firefox=firefoxdeveloperedition
```

## Node.js CLI для вычисления среднего арифметического

```js
function prompt(question, callback) {
  let stdin = process.stdin,
    stdout = process.stdout;

  stdin.resume();
  stdout.write(question);

  stdin.once("data", function (data) {
    callback(data.toString().trim());
  });
}

prompt(
  'Введите числа через запятую, например "3.9, 6, 7.8, 6", без кавычек: ',
  function (input) {
    let a = input.split(",");
    console.log("Введено:", a);
    let b = 0;

    a.forEach(num => {
      b += parseFloat(num);
    });
    console.log("Среднее арифметическое данных чисел:", b / a.length);
    prompt("Нажмите Enter, чтобы выйти: ", function (input) {
      process.exit();
    });
  }
);
```
