<!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  {% if site.prefer_datetime_locale %}
    <meta name="prefer-datetime-locale" content="{{ site.prefer_datetime_locale }}">
  {% endif %}

  {% if page.layout == 'home' or page.layout == 'post' %}

    {% if site.google_analytics.pv.proxy_endpoint %}
      <meta name="pv-proxy-endpoint" content="{{ site.google_analytics.pv.proxy_endpoint }}">
    {% endif %}

    {% if site.google_analytics.pv.cache_path %}
      <meta name="pv-cache-path" content="{{ site.google_analytics.pv.cache_path | relative_url }}">
    {% endif %}

  {% endif %}

  {% capture seo_tags %}
    {% seo title=false %}
  {% endcapture %}

  {% if site.img_cdn and seo_tags contains 'og:image' %}
    {% assign properties = 'og:image,twitter:image' | split: ',' %}

    {% for prop in properties %}
      {% if site.img_cdn contains '//' %}
        <!-- `site.img_cdn` is a cross-origin URL -->
        {% capture target %}<meta property="{{ prop }}" content="{{ site.url }}{% endcapture %}
        {% capture replacement %}<meta property="{{ prop }}" content="{{ site.img_cdn }}{% endcapture %}
      {% else %}
        <!-- `site.img_cdn` is a local file path -->
        {% capture target %}<meta property="{{ prop }}" content="{{ site.url }}{{ site.baseurl }}{% endcapture %}
        {% assign replacement = target | append: site.img_cdn %}
      {% endif %}

      {% assign seo_tags = seo_tags | replace: target, replacement %}

    {% endfor %}
  {% endif %}

  {{ seo_tags }}

  <title>
  {%- unless page.layout == "home" -%}
    {{ page.title | append: " | "}}
  {%- endunless -%}
    {{ site.title }}
  </title>

  {% include favicons.html %}

  {% if site.resources.ignore_env != jekyll.environment and site.resources.self_hosted %}

    <link href="{{ site.data.assets[origin].webfonts | relative_url }}" rel="stylesheet">

  {% else %}

    {% for cdn in site.data.assets[origin].cdns %}
      <link rel="preconnect" href="{{ cdn.url }}" {{ cdn.args }}>
      <link rel="dns-prefetch" href="{{ cdn.url }}" {{ cdn.args }}>
    {% endfor %}

    <link rel="stylesheet" href="{{ site.data.assets[origin].webfonts | relative_url }}">

  {% endif %}

  <!-- GA -->
  {% if jekyll.environment == 'production'
      and site.google_analytics.id != empty and site.google_analytics.id %}
    <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">

    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    {% if site.google_analytics.pv.proxy_endpoint %}
      {% assign proxy_url = site.google_analytics.pv.proxy_endpoint
          | replace: "https://", "" | split: "/" | first | prepend: "https://" %}
      <link rel="preconnect" href="{{ proxy_url }}" crossorigin="use-credentials">
      <link rel="dns-prefetch" href="{{ proxy_url }}">
    {% endif %}
  {% endif %}

  <!-- Bootstrap -->
  <link rel="stylesheet" href="{{ site.data.assets[origin].bootstrap.css | relative_url}}">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="{{ site.data.assets[origin].fontawesome.css | relative_url }}">

  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">

  {% if site.toc and page.toc %}
    <link rel="stylesheet" href="{{ site.data.assets[origin].bootstrap-toc.css | relative_url }}">
  {% endif %}

  {% if page.layout == 'page' or page.layout == 'post' %}
    <!-- Manific Popup -->
    <link rel="stylesheet" href="{{ site.data.assets[origin].magnific-popup.css | relative_url }}">
  {% endif %}

  <!-- JavaScript -->

  <script src="{{ site.data.assets[origin].jquery.js | relative_url }}"></script>

  {% unless site.theme_mode %}
    {% include mode-toggle.html %}
  {% endunless %}

  <link
    href="https://unpkg.com/video.js@7/dist/video-js.min.css"
    rel="stylesheet"
  />
  <link
    href="https://unpkg.com/@videojs/themes@1/dist/sea/index.css"
    rel="stylesheet"
  />
  <script src="https://vjs.zencdn.net/7.20.1/video.min.js"></script>
  <script src="https://unpkg.com/swipe-event-listener@1.2.1/dist/swipe-event-listener.js"></script>
  <link rel="stylesheet" href="{{- 'assets/custom.css' | relative_url -}}">
  <script src="{{- 'assets/custom.js' | relative_url -}}"></script>

  {% if page.layout == 'home' %}
    <script type="text/javascript" src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>
    <link rel="stylesheet" href="{{ site.data.assets[origin].magnific-popup.css | relative_url }}">

    <script>
    // $(function() {

      // const IMG_SCOPE = '#main div.post-preview.post-preview-with-image';

      // if ($(`${IMG_SCOPE} img`).length <= 0 ) {
      //   return;
      // }

      // const imgList = document.querySelectorAll(`${IMG_SCOPE} img[data-src]`);
      // const observer = lozad(imgList);
      // observer.observe();

      // const imgList = document.querySelectorAll(`${IMG_SCOPE} img[data-src]`);
      // imgList.forEach((e) => {
      //   e.src = e.dataset["src"];
      // })

      // $(`${IMG_SCOPE} p > img[data-src],${IMG_SCOPE} img[data-src].preview-img`).each(
      //   function() {
      //     let nextTag = $(this).next();
      //     const title = nextTag.prop('tagName') === 'EM' ? nextTag.text() : '';
      //     const src = $(this).attr('data-src');

      //     $(this).wrap(`<a href="${src}" title="${title}" class="popup"></a>`);
      //   }
      // );

      // $('.popup').magnificPopup({
      //   type: 'image',
      //   closeOnContentClick: true,
      //   showCloseBtn: false,
      //   zoom: {
      //     enabled: true,
      //     duration: 300,
      //     easing: 'ease-in-out'
      //   }
      // });

      // $(`${IMG_SCOPE} a`).has('img').addClass('img-link');

    // });
    </script>
    <link rel="stylesheet" href="{{- 'assets/custom-home.css' | relative_url -}}">
  {% endif %}
</head>
